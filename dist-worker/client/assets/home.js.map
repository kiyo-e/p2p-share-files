{"version":3,"file":"home.js","sources":["../../src/client/home.tsx"],"sourcesContent":["/** @jsxImportSource hono/jsx/dom */\n/**\n * Home client app for share-files.\n * See README.md; pairs with src/ui/top.tsx.\n */\n\nimport { render, useCallback, useState } from \"hono/jsx/dom\";\n\nconst creatorCid = getClientId();\n\nconst root = document.querySelector(\"main.container\");\nif (root && document.getElementById(\"homeView\")) {\n  render(<HomeApp />, root);\n}\n\nfunction HomeApp() {\n  const [encryptEnabled, setEncryptEnabled] = useState(true);\n  const [busy, setBusy] = useState(false);\n  const [joinCode, setJoinCode] = useState(\"\");\n  const [maxConcurrent, setMaxConcurrent] = useState(3);\n\n  const handleEncryptToggle = useCallback((ev: Event) => {\n    const target = ev.currentTarget as HTMLInputElement;\n    setEncryptEnabled(target.checked);\n  }, []);\n\n  const handleJoinInput = useCallback((ev: Event) => {\n    const target = ev.currentTarget as HTMLInputElement;\n    setJoinCode(target.value);\n  }, []);\n\n  const handleMaxConcurrentInput = useCallback((ev: Event) => {\n    const target = ev.currentTarget as HTMLInputElement;\n    const next = Number.parseInt(target.value, 10);\n    if (Number.isFinite(next)) {\n      setMaxConcurrent(Math.max(1, Math.min(10, next)));\n    }\n  }, []);\n\n  const handleCreate = useCallback(async () => {\n    if (busy) return;\n    setBusy(true);\n    try {\n      const { roomId } = await apiCreateRoom({ maxConcurrent, creatorCid });\n      if (encryptEnabled) {\n        const rawKey = crypto.getRandomValues(new Uint8Array(32));\n        const k = b64urlEncode(rawKey);\n        location.href = `/r/${roomId}#k=${k}`;\n      } else {\n        location.href = `/r/${roomId}`;\n      }\n    } finally {\n      setBusy(false);\n    }\n  }, [busy, encryptEnabled]);\n\n  const handleJoin = useCallback(() => {\n    const code = joinCode.trim().toUpperCase();\n    if (!code) return;\n    location.href = `/r/${code}${location.hash || \"\"}`;\n  }, [joinCode]);\n\n  return (\n    <section id=\"homeView\" class=\"card home\">\n      <div class=\"homeGrid\">\n        <div class=\"homeHero\">\n          <div class=\"eyebrow\">DIRECT—PRIVATE—INSTANT</div>\n          <h1>\n            ファイルを<br />直接送る\n          </h1>\n          <p class=\"lead\">\n            サーバにアップロードせず、端末間で直接転送。接続の取り次ぎだけサーバを使います。\n          </p>\n          <div class=\"heroChips\">\n            <span class=\"chip\">NO SERVER STORAGE</span>\n            <span class=\"chip\">1:N P2P</span>\n            <span class=\"chip\">WEBRTC</span>\n          </div>\n          <div class=\"steps\">\n            <div class=\"step\">\n              <span>1</span> ルーム作成\n            </div>\n            <div class=\"step\">\n              <span>2</span> リンク共有\n            </div>\n            <div class=\"step\">\n              <span>3</span> 送信\n            </div>\n          </div>\n        </div>\n\n        <div class=\"homePanel\">\n          <div class=\"panelBlock\">\n            <div class=\"panelTitle\">送信を開始</div>\n            <label class=\"toggle\">\n              <input\n                id=\"encryptToggle\"\n                type=\"checkbox\"\n                checked={encryptEnabled}\n                disabled={busy}\n                onInput={handleEncryptToggle}\n              />\n              <span>E2E暗号化ON</span>\n            </label>\n            <label class=\"row gap\">\n              <span class=\"muted small\">同時送信上限</span>\n              <input\n                id=\"maxConcurrent\"\n                class=\"input\"\n                type=\"number\"\n                min=\"1\"\n                max=\"10\"\n                value={String(maxConcurrent)}\n                disabled={busy}\n                onInput={handleMaxConcurrentInput}\n              />\n            </label>\n            <button id=\"createBtn\" class=\"btn primary\" disabled={busy} onClick={handleCreate}>\n              ルーム作成\n            </button>\n          </div>\n\n          <hr class=\"sep\" />\n\n          <div class=\"panelBlock\">\n            <div class=\"panelTitle\">受信に参加</div>\n            <div class=\"row gap wrap\">\n              <input\n                id=\"joinCode\"\n                class=\"input\"\n                placeholder=\"コード入力（例: ABCD...）\"\n                value={joinCode}\n                disabled={busy}\n                onInput={handleJoinInput}\n              />\n              <button id=\"joinBtn\" class=\"btn\" disabled={busy} onClick={handleJoin}>\n                参加\n              </button>\n            </div>\n            <p class=\"muted small\">暗号化ONならリンクに鍵が含まれます。</p>\n          </div>\n        </div>\n      </div>\n\n      <div class=\"foot muted\">P2Pのみ。ネットワーク条件によっては接続不可（TURN無し）</div>\n    </section>\n  );\n}\n\nasync function apiCreateRoom(body: { maxConcurrent: number; creatorCid: string }): Promise<{ roomId: string }> {\n  const res = await fetch(\"/api/rooms\", {\n    method: \"POST\",\n    headers: { \"content-type\": \"application/json\" },\n    body: JSON.stringify(body),\n  });\n  if (!res.ok) throw new Error(\"ルーム作成に失敗しました\");\n  return res.json();\n}\n\nfunction b64urlEncode(u8: Uint8Array) {\n  let s = \"\";\n  for (let i = 0; i < u8.length; i++) s += String.fromCharCode(u8[i]);\n  return btoa(s).replace(/\\+/g, \"-\").replace(/\\//g, \"_\").replace(/=+$/g, \"\");\n}\n\nfunction getClientId() {\n  const key = \"share-files-client-id\";\n  const stored = localStorage.getItem(key);\n  if (stored) return stored;\n  const id = crypto.randomUUID();\n  localStorage.setItem(key, id);\n  return id;\n}\n"],"names":["creatorCid","getClientId","root","render","jsx","HomeApp","encryptEnabled","setEncryptEnabled","useState","busy","setBusy","joinCode","setJoinCode","maxConcurrent","setMaxConcurrent","handleEncryptToggle","useCallback","ev","target","handleJoinInput","handleMaxConcurrentInput","next","handleCreate","roomId","apiCreateRoom","rawKey","k","b64urlEncode","handleJoin","code","jsxs","body","res","u8","s","i","key","stored","id"],"mappings":"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"}